{% comment %}
  STRONGSIDE Custom Header - Exact Replica of React Navbar
{% endcomment %}

<script src="{{ 'cart-notification.js' | asset_url }}" defer="defer"></script>
<script src="{{ 'strongside-header.js' | asset_url }}" defer="defer"></script>

<style>
  /* Base reset for header - Adjusted for Mobile */
  .strongside-header-wrapper {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    z-index: 9999;
    transition: all 0.3s ease;
    padding: 1rem 1.5rem; /* Reduced from 2.4rem 2.4rem for mobile */
    background-color: rgba(0, 0, 0, 0.2);
    border-bottom: 1px solid rgba(255, 255, 255, 0.05);
    backdrop-filter: blur(12px);
  }

  @media (min-width: 768px) {
    .strongside-header-wrapper {
      padding: 2.4rem 4.8rem;
    }
  }

  /* Scroll States */
  .strongside-header-wrapper.is-scrolled {
    background-color: rgba(5, 5, 5, 0.95) !important;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    padding: 0.8rem 1.5rem !important; /* Mobile shrunk state */
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
  }

  @media (min-width: 768px) {
    .strongside-header-wrapper.is-scrolled {
      padding: 1.6rem 4.8rem !important; /* Desktop shrunk state */
    }
  }

  .strongside-header-wrapper.is-transparent {
    background-color: rgba(0, 0, 0, 0.2);
    border-bottom: 1px solid rgba(255, 255, 255, 0.05);
  }

  .strongside-nav-container {
    display: flex;
    align-items: center;
    justify-content: space-between;
    max-width: 95%; /* Keep width safe */
    margin: 0 auto;
    position: relative;
    gap: 1rem; /* Add gap to prevent overlap */
  }

  /* LOGO - Mobile Optimized */
  .strongside-logo {
    font-size: 1.5rem; /* Reduced from 2.4rem for mobile */
    font-weight: 900;
    letter-spacing: -0.05em;
    color: white;
    font-style: italic;
    cursor: pointer;
    text-decoration: none;
    user-select: none;
    transition: color 0.3s;
    font-family: 'Inter', sans-serif !important;
    margin-left: 0 !important;
    white-space: nowrap; /* Prevent wrap */
    flex-shrink: 1; /* Allow shrink if needed */
  }

  @media (min-width: 768px) {
    .strongside-logo {
      font-size: 2.4rem; /* Restore Desktop Size */
    }
  }

  @media (min-width: 1024px) {
    .strongside-logo {
      margin-left: 15rem !important;
    }
  }

  .strongside-logo span {
    font-family: 'Inter', sans-serif !important;
    color: #ff2222; /* BRAND ACCENT (Rouge) comme demandé */
    font-weight: 900 !important; /* Gras */
    margin-left: 0.1rem;
    font-style: italic; /* Italique */
  }

  /* DESKTOP MENU */
  .strongside-desktop-menu {
    display: none;
  }

  @media (min-width: 768px) {
    .strongside-desktop-menu {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.8rem; /* React: space-x-2 (0.5rem) -> 0.8rem */
    }
  }

  /* LINKS - Scaled 1.6x */
  .strongside-nav-link {
    padding: 0 1.6rem; /* React: px-4 (1rem) -> 1.6rem */
    text-align: center;
    font-size: 1.2rem; /* React: text-xs (0.75rem) -> 1.2rem */
    font-weight: 800;
    letter-spacing: 0.15em;
    text-transform: uppercase;
    color: #9ca3af;
    text-decoration: none;
    transition: color 0.3s;
  }

  .strongside-nav-link:hover {
    color: white;
  }

  /* Pill style - Scaled 1.6x */
  .strongside-nav-link.is-pill {
    padding: 0.6rem 1.6rem; /* React: py-1.5 (0.375rem) -> 0.6rem, px-4 -> 1.6rem */
    color: white;
    background-color: rgba(255, 34, 34, 0.2);
    border: 1px solid rgba(255, 34, 34, 0.5);
    border-radius: 9999px;
    margin-right: 0.8rem;
    font-size: 1.2rem;
  }

  /* Account Button - Scaled 1.6x */
  .strongside-account-btn {
    padding: 0.4rem 1.6rem; /* React: py-1 (0.25rem) -> 0.4rem, px-4 -> 1.6rem */
    text-align: center;
    font-size: 1.2rem; /* React: text-xs -> 1.2rem */
    font-weight: 800;
    letter-spacing: 0.15em;
    color: #ff2222;
    text-transform: uppercase;
    text-decoration: none;
    border: 1px solid rgba(255, 34, 34, 0.3);
    border-radius: 9999px;
    margin-left: 0.8rem;
    transition: all 0.3s;
  }

  /* Separator */
  .strongside-separator {
    height: 1rem;
    width: 1px;
    background-color: #374151; /* bg-gray-700 */
    margin: 0 1.5rem;
  }

  /* RIGHT ICONS */
  .strongside-icons {
    display: flex;
    align-items: center;
    gap: 0.8rem; /* Mobile: Reduced gap from 1.5rem */
    justify-content: flex-end;
  }

  @media (min-width: 768px) {
    .strongside-icons {
      gap: 1.5rem; /* Desktop: Restore gap */
    }
  }

  .strongside-icon-btn {
    position: relative;
    color: white;
    background: none;
    border: none;
    cursor: pointer;
    padding: 0;
    transition: color 0.3s;
  }

  .strongside-icon-btn:hover {
    color: #ff2222;
  }

  .strongside-cart-badge {
    position: absolute;
    top: -0.5rem;
    right: -0.5rem;
    background-color: #ff2222;
    color: white;
    font-size: 0.625rem;
    font-weight: 700;
    width: 1rem;
    height: 1rem;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  /* MOBILE HAMBURGER */
  .strongside-hamburger {
    display: block;
    color: white;
    background: none;
    border: none;
    cursor: pointer;
    z-index: 60; /* Higher than header */
    position: relative;
  }

  .strongside-hamburger:hover {
    color: #ff2222;
  }

  @media (min-width: 768px) {
    .strongside-hamburger {
      display: none;
    }
  }

  /* MOBILE MENU OVERLAY */
  .strongside-mobile-menu {
    position: fixed;
    inset: 0;
    z-index: 2147483647; /* MAX Z-INDEX to cover header (9999) */
    background-color: rgba(0, 0, 0, 0.95);
    backdrop-filter: blur(24px);
    display: flex;
    flex-col: column;
    align-items: center;
    justify-content: center;
    opacity: 0;
    pointer-events: none; /* Hidden by default */
    transition: opacity 0.3s ease;
  }

  .strongside-mobile-menu.is-open {
    opacity: 1;
    pointer-events: auto;
  }

  .strongside-mobile-content {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 2rem;
    width: 100%;
    padding: 2rem;
  }

  .strongside-mobile-link {
    font-size: 2.1rem; /* text-2xl scaled up 40% */
    font-weight: 900;
    text-transform: uppercase;
    font-style: italic;
    letter-spacing: 0.1em;
    color: white;
    text-decoration: none;
    transition: color 0.3s;
  }

  .strongside-mobile-link:hover {
    color: #ff2222;
  }

  .strongside-mobile-link.is-pill {
    color: #ff2222;
    background-color: rgba(255, 34, 34, 0.2);
    border: 1px solid rgba(255, 34, 34, 0.5);
    border-radius: 9999px;
    padding: 0.5rem 1.5rem;
  }

  .strongside-mobile-link.is-pill:hover {
    color: white;
    background-color: #ff2222;
  }

  .strongside-mobile-close {
    position: absolute;
    top: 1.5rem;
    right: 1.5rem;
    color: white;
    background: none;
    border: none;
    cursor: pointer;
  }

  .strongside-mobile-close:hover {
    color: #ff2222;
  }

  /* =====================================================
     LIGHT MODE CONDITIONAL OVERRIDES
     ===================================================== */

  /* Header background in light mode - when scrolled */
  .strongside-light .strongside-header-wrapper.is-scrolled {
    background-color: rgba(255, 255, 255, 0.95) !important;
    border-bottom: 1px solid rgba(0, 0, 0, 0.1) !important;
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05) !important;
  }

  /* Header background in light mode - when transparent (on hero) */
  .strongside-light .strongside-header-wrapper.is-transparent {
    background-color: rgba(255, 255, 255, 0.8) !important;
    border-bottom: 1px solid rgba(0, 0, 0, 0.1) !important;
    backdrop-filter: blur(8px) !important;
  }

  /* Logo text - black in light mode (BOTH states) */
  .strongside-light .strongside-logo,
  .strongside-light .strongside-header-wrapper.is-transparent .strongside-logo,
  .strongside-light .strongside-header-wrapper.is-scrolled .strongside-logo {
    color: #111827 !important;
  }

  /* technologies text stays red */
  .strongside-light .strongside-logo span {
    color: #ff2222 !important;
  }

  /* Nav links - dark gray in light mode (BOTH states) */
  .strongside-light .strongside-nav-link,
  .strongside-light .strongside-header-wrapper.is-transparent .strongside-nav-link,
  .strongside-light .strongside-header-wrapper.is-scrolled .strongside-nav-link {
    color: #374151 !important;
  }

  .strongside-light .strongside-nav-link:hover {
    color: #111827 !important;
  }

  /* Equipment pill - dark text on light red background */
  .strongside-light .strongside-nav-link.is-pill {
    color: #111827 !important;
    background-color: rgba(255, 34, 34, 0.15) !important;
    border: 1px solid rgba(255, 34, 34, 0.5) !important;
  }

  .strongside-light .strongside-nav-link.is-pill:hover {
    background-color: #ff2222 !important;
    color: white !important;
  }

  /* Account button stays red (ALL states) */
  .strongside-light .strongside-account-btn,
  .strongside-light .strongside-header-wrapper.is-transparent .strongside-account-btn,
  .strongside-light .strongside-header-wrapper.is-scrolled .strongside-account-btn {
    color: #ff2222 !important;
    border-color: rgba(255, 34, 34, 0.5) !important;
  }

  /* Icons - outline style in light mode (BOTH states) - NO FILL, just strokes */
  .strongside-light .strongside-icon-btn,
  .strongside-light .strongside-header-wrapper.is-transparent .strongside-icon-btn,
  .strongside-light .strongside-header-wrapper.is-scrolled .strongside-icon-btn {
    color: #111827 !important;
  }

  .strongside-light .strongside-icon-btn svg,
  .strongside-light .strongside-header-wrapper.is-transparent .strongside-icon-btn svg,
  .strongside-light .strongside-header-wrapper.is-scrolled .strongside-icon-btn svg {
    fill: none !important;
    stroke: #111827 !important;
  }

  .strongside-light .strongside-icon-btn:hover {
    color: #ff2222 !important;
  }

  .strongside-light .strongside-icon-btn:hover svg {
    stroke: #ff2222 !important;
  }

  /* Hamburger - dark in light mode (BOTH states) */
  .strongside-light .strongside-hamburger,
  .strongside-light .strongside-header-wrapper.is-transparent .strongside-hamburger,
  .strongside-light .strongside-header-wrapper.is-scrolled .strongside-hamburger {
    color: #111827 !important;
  }

  .strongside-light .strongside-hamburger:hover {
    color: #ff2222 !important;
  }

  /* Mobile menu - light background in light mode */
  .strongside-light .strongside-mobile-menu {
    background-color: rgba(255, 255, 255, 0.98) !important;
  }

  .strongside-light .strongside-mobile-link {
    color: #111827 !important;
  }

  .strongside-light .strongside-mobile-link:hover {
    color: #ff2222 !important;
  }

  .strongside-light .strongside-mobile-link.is-pill {
    color: #ff2222 !important;
  }

  .strongside-light .strongside-mobile-close {
    color: #111827 !important;
  }

  .strongside-light .strongside-mobile-close:hover {
    color: #ff2222 !important;
  }

  /* Separator - darker in light mode */
  .strongside-light .strongside-separator {
    background-color: #d1d5db !important;
  }

  /* Language dropdown - white background */
  .strongside-light .strongside-lang-list {
    background-color: #ffffff !important;
    border: 1px solid #e5e7eb !important;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1) !important;
  }

  .strongside-light .strongside-lang-item {
    color: #111827 !important;
  }

  .strongside-light .strongside-lang-item:hover {
    background-color: #f3f4f6 !important;
    color: #ff2222 !important;
  }
</style>

<div id="shopify-section-header" class="strongside-header-wrapper is-transparent">
  <div class="strongside-nav-container">
    <!-- LEFT: LOGO -->
    <a href="{{ routes.root_url }}" class="strongside-logo"> STRONGSIDE <span>technologies</span> </a>

    <!-- CENTER: DESKTOP MENU -->
    <nav class="strongside-desktop-menu">
      <!-- Hardcoded links to match React exactly, dynamic Shopify links can be added via settings if needed -->
      <!-- Item 1: Equipment (Pill) -->
      <a
        href="{{ routes.root_url }}"
        class="strongside-nav-link is-pill"
        onclick="if(document.getElementById('elastics-section')) { event.preventDefault(); window.scrollTo({top:0, behavior:'smooth'}); }"
      >
        {{- 'strongside.header.equipment' | t -}}
      </a>

      <!-- Item 2: Reinforcements -->
      <a
        href="{{ routes.root_url }}#elastics-section"
        class="strongside-nav-link"
        onclick="const el = document.getElementById('elastics-section'); if(el) { event.preventDefault(); const top = el.getBoundingClientRect().top + window.scrollY - 120; window.scrollTo({top: top, behavior: 'smooth'}); }"
      >
        {{- 'strongside.header.reinforcements' | t -}}
      </a>

      <a
        href="{{ routes.root_url }}#training-videos"
        class="strongside-nav-link"
        onclick="const el = document.getElementById('training-videos'); if(el) { event.preventDefault(); const top = el.getBoundingClientRect().top + window.scrollY - 70; window.scrollTo({top: top, behavior: 'smooth'}); }"
      >
        {{- 'strongside.header.training' | t -}}
      </a>

      <!-- Item 3b: ACADEMY (Blog) -->
      <a
        href="/blogs/strongside-academy"
        class="strongside-nav-link"
      >
        ACADEMY
      </a>

      <!-- Item 4: FAQ -->
      <a
        href="{{ routes.root_url }}#faq-section"
        class="strongside-nav-link"
        onclick="const el = document.getElementById('faq-section'); if(el) { event.preventDefault(); const top = el.getBoundingClientRect().top + window.scrollY - 70; window.scrollTo({top: top, behavior: 'smooth'}); }"
      >
        {{- 'strongside.header.faq' | t -}}
      </a>

      <!-- ACCOUNT -->
      <!-- ACCOUNT -->
      <a
        href="{%- if customer -%}{{ routes.account_url }}{%- else -%}{{ routes.account_login_url }}{%- endif -%}"
        class="strongside-account-btn"
      >
        {{- 'strongside.header.account' | t -}}
      </a>

      <div class="strongside-separator"></div>

      <!-- Language Selector (Functional) -->
      {%- if localization.available_languages.size > 1 -%}
        <localization-form class="no-js-hidden" data-prevent-hide>
          {%- form 'localization', id: 'HeaderLanguageFormDesktop', class: 'localization-form' -%}
            <div class="strongside-lang-wrapper" style="position:relative;">
              <button
                type="button"
                class="strongside-nav-link"
                aria-expanded="false"
                aria-controls="HeaderLanguageListDesktop"
                aria-describedby="HeaderLanguageLabelDesktop"
                style="border:none;background:none;padding:0;cursor:pointer;display:flex;align-items:center;gap:4px;"
              >
                {{ localization.language.iso_code | upcase }}
                <span style="font-size:0.6em;">▼</span>
              </button>
              <ul
                id="HeaderLanguageListDesktop"
                role="list"
                class="strongside-lang-list"
                hidden
                style="position:absolute;top:100%;right:0;list-style:none;padding:0;margin:0;min-width:60px;z-index:99;border-radius:8px;overflow:hidden;"
              >
                {%- for language in localization.available_languages -%}
                  <li class="localization-form__item" tabindex="-1">
                    <a
                      class="strongside-lang-item"
                      href="#"
                      hreflang="{{ language.iso_code }}"
                      lang="{{ language.iso_code }}"
                      {% if language.iso_code == localization.language.iso_code %}
                        aria-current="true"
                      {% endif %}
                      data-value="{{ language.iso_code }}"
                      style="display:block;padding:8px 12px;text-decoration:none;font-size:12px;font-weight:bold;text-transform:uppercase;"
                    >
                      {{ language.iso_code | upcase }}
                    </a>
                  </li>
                {%- endfor -%}
              </ul>
              <input type="hidden" name="locale_code" value="{{ localization.language.iso_code }}">
            </div>
          {%- endform -%}
          <script>
            // Robust Language Selector Logic
            document.addEventListener('DOMContentLoaded', function () {
              const langBtn = document.querySelector('#HeaderLanguageFormDesktop button');
              const langList = document.querySelector('#HeaderLanguageListDesktop');

              if (langBtn && langList) {
                langBtn.addEventListener('click', function (e) {
                  e.stopPropagation();
                  const isHidden = langList.hidden;
                  langList.hidden = !isHidden;
                  this.setAttribute('aria-expanded', isHidden);
                });

                // Close dropdown when clicking outside
                document.addEventListener('click', function (e) {
                  if (!langBtn.contains(e.target) && !langList.contains(e.target)) {
                    langList.hidden = true;
                    langBtn.setAttribute('aria-expanded', 'false');
                  }
                });
              }

              document.querySelectorAll('.strongside-lang-item').forEach((item) => {
                item.addEventListener('click', function (e) {
                  e.preventDefault();
                  const form = document.getElementById('HeaderLanguageFormDesktop');
                  const input = form.querySelector('input[name="locale_code"]');
                  const newLang = this.getAttribute('lang');

                  if (form && input && newLang) {
                    input.value = newLang;
                    form.submit();
                  }
                });
              });
            });
          </script>
        </localization-form>
      {%- else -%}
        <!-- Fallback if only 1 language (just display it) -->
        <span class="strongside-nav-link">{{ localization.language.iso_code | upcase }}</span>
      {%- endif -%}
    </nav>

    <!-- RIGHT: ICONS -->
    <div class="strongside-icons">
      <!-- Theme Toggle (Moved here) -->
      <button
        id="theme-toggle"
        class="strongside-icon-btn"
        aria-label="Toggle Dark Mode"
        style="margin-right:1rem;display:flex;align-items:center;justify-content:center;"
      >
        <!-- Sun Icon (for Dark Mode) -->
        <svg
          id="sun-icon"
          xmlns="http://www.w3.org/2000/svg"
          width="20"
          height="20"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
          stroke-width="2"
          style="display:none;"
        >
          <path stroke-linecap="round" stroke-linejoin="round" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" />
        </svg>
        <!-- Moon Icon (for Light Mode) -->
        <svg
          id="moon-icon"
          xmlns="http://www.w3.org/2000/svg"
          width="20"
          height="20"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
          stroke-width="2"
          style="display:none;"
        >
          <path stroke-linecap="round" stroke-linejoin="round" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" />
        </svg>
      </button>

      <!-- Cart Icon -->
      <a href="{{ routes.cart_url }}" class="strongside-icon-btn" id="cart-icon-bubble">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="24"
          height="24"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
          stroke-width="2"
        >
          <path stroke-linecap="round" stroke-linejoin="round" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z" />
        </svg>
        {%- if cart.item_count > 0 -%}
          <div class="cart-count-bubble">
            <span aria-hidden="true">{{ cart.item_count }}</span>
            <span class="visually-hidden">{{ 'sections.header.cart_count' | t: count: cart.item_count }}</span>
          </div>
        {%- endif -%}
      </a>

      <!-- Mobile Hamburger -->
      <button class="strongside-hamburger" onclick="toggleMobileMenu()">
        <svg width="32" height="32" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h16" />
        </svg>
      </button>
    </div>
  </div>
</div>

<!-- MOBILE MENU OVERLAY -->
<div id="strongside-mobile-menu" class="strongside-mobile-menu">
  <button class="strongside-mobile-close" onclick="toggleMobileMenu()">
    <svg width="40" height="40" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
      <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
    </svg>
  </button>

  <div class="strongside-mobile-content">
    <a
      href="{{ routes.root_url }}"
      class="strongside-mobile-link is-pill"
      onclick="if(document.getElementById('elastics-section')) { event.preventDefault(); window.scrollTo({top:0, behavior:'smooth'}); } toggleMobileMenu();"
    >
      {{- 'strongside.header.equipment' | t -}}
    </a>
    <a
      href="{{ routes.root_url }}#elastics-section"
      class="strongside-mobile-link"
      onclick="const el = document.getElementById('elastics-section'); if(el) { event.preventDefault(); const top = el.getBoundingClientRect().top + window.scrollY - 120; window.scrollTo({top: top, behavior: 'smooth'}); } toggleMobileMenu();"
    >
      {{- 'strongside.header.reinforcements' | t -}}
    </a>
    <a
      href="{{ routes.root_url }}#training-videos"
      class="strongside-mobile-link"
      onclick="const el = document.getElementById('training-videos'); if(el) { event.preventDefault(); const top = el.getBoundingClientRect().top + window.scrollY - 70; window.scrollTo({top: top, behavior: 'smooth'}); } toggleMobileMenu();"
    >
      {{- 'strongside.header.training' | t -}}
    </a>

    <!-- Item Mobile: ACADEMY -->
    <a
      href="/blogs/strongside-academy"
      class="strongside-mobile-link"
      onclick="toggleMobileMenu();"
    >
      ACADEMY
    </a>
    <a
      href="{{ routes.root_url }}#faq-section"
      class="strongside-mobile-link"
      onclick="const el = document.getElementById('faq-section'); if(el) { event.preventDefault(); const top = el.getBoundingClientRect().top + window.scrollY - 70; window.scrollTo({top: top, behavior: 'smooth'}); } toggleMobileMenu();"
    >
      {{- 'strongside.header.faq' | t -}}
    </a>
    <a
      href="{%- if customer -%}{{ routes.account_url }}{%- else -%}{{ routes.account_login_url }}{%- endif -%}"
      class="strongside-mobile-link"
      style="color:#ff2222;border:1px solid rgba(255,34,34,0.5);border-radius:9999px;padding:0.75rem 2rem;font-size:1.75rem;font-weight:900;font-style:italic;"
    >
      {{- 'strongside.header.account' | t -}}
    </a>

    <!-- Theme Toggle Mobile Button was moved to bottom -->

    <!-- Mobile Language Selector (Grid Layout) -->
    {%- if localization.available_languages.size > 1 -%}
      <localization-form class="no-js-hidden">
        {%- form 'localization', id: 'HeaderLanguageFormMobile', class: 'localization-form' -%}
          <div style="display:grid; grid-template-columns: repeat(3, 1fr); gap:1rem; margin:1rem auto; max-width: 300px; justify-items: center;">
            {%- for language in localization.available_languages -%}
              <button
                type="button"
                class="strongside-mobile-lang-btn"
                lang="{{ language.iso_code }}"
                {% if language.iso_code == localization.language.iso_code %}
                  aria-current="true"
                {% endif %}
                style="background:none;border:none;cursor:pointer;font-weight:900;font-style:italic;font-size:1.75rem;text-transform:uppercase;color:{% if language.iso_code == localization.language.iso_code %}#ff2222{% else %}#6b7280{% endif %};"
              >
                {{ language.iso_code | upcase }}
              </button>
            {%- endfor -%}
            <input type="hidden" name="locale_code" value="{{ localization.language.iso_code }}">
          </div>
        {%- endform -%}
      </localization-form>

      <script>
        document.querySelectorAll('.strongside-mobile-lang-btn').forEach((btn) => {
          btn.addEventListener('click', function (e) {
            e.preventDefault();
            const form = document.getElementById('HeaderLanguageFormMobile');
            const input = form.querySelector('input[name="locale_code"]');
            const newLang = this.getAttribute('lang');

            if (form && input && newLang) {
              input.value = newLang;
              form.submit();
            }
          });
        });
      </script>
    {%- endif -%}

    <!-- Theme Toggle Mobile (Centered at bottom) -->
    <button
      id="theme-toggle-mobile"
      class="strongside-mobile-link"
      style="background:none;border:none;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:0.5rem;margin-top:1rem;"
    >
      <svg width="24" height="24" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" />
      </svg>
      <span id="theme-text-mobile" style="font-size:1.2rem;font-weight:900;font-style:italic;">LIGHT MODE</span>
    </button>
  </div>
</div>

<script>
  // ----- MOBILE MENU -----
  function toggleMobileMenu() {
    const menu = document.getElementById('strongside-mobile-menu');
    menu.classList.toggle('is-open');
    document.body.style.overflow = menu.classList.contains('is-open') ? 'hidden' : '';
  }

  // ----- SCROLL EFFECT -----
  window.addEventListener('scroll', () => {
    const header = document.querySelector('.strongside-header-wrapper');
    if (window.scrollY > 50) {
      header.classList.add('is-scrolled');
      header.classList.remove('is-transparent');
    } else {
      header.classList.add('is-transparent');
      header.classList.remove('is-scrolled');
    }
  });

  // ----- DARK MODE LOGIC (NATIVE SCHEME SWAP) -----
  document.addEventListener('DOMContentLoaded', () => {
    const body = document.body;
    const toggleBtn = document.getElementById('theme-toggle');
    const toggleBtnMobile = document.getElementById('theme-toggle-mobile');
    const sunIcon = document.getElementById('sun-icon');
    const moonIcon = document.getElementById('moon-icon');
    const themeTextMobile = document.getElementById('theme-text-mobile');

    // Define Dark Schemes relative to settings_data.json
    // Schemes 1-4 are Dark. Scheme 6 is Light.
    const LIGHT_SCHEME = 'color-scheme-6';
    const DARK_SCHEMES = ['color-scheme-1', 'color-scheme-2', 'color-scheme-3', 'color-scheme-4'];

    // Check localStorage - default to LIGHT (new visitors get light mode)
    const isDark = localStorage.getItem('theme') === 'dark';

    function applyLightSchemeToElement(el) {
      if (el.classList.contains(LIGHT_SCHEME)) return;

      // Check if it has any dark scheme
      const currentScheme = DARK_SCHEMES.find((scheme) => el.classList.contains(scheme));
      if (currentScheme) {
        el.dataset.originalScheme = currentScheme;
        el.classList.remove(currentScheme);
        el.classList.add(LIGHT_SCHEME);
      }
    }

    function removeLightSchemeFromElement(el) {
      if (!el.classList.contains(LIGHT_SCHEME)) return;

      const originalScheme = el.dataset.originalScheme || 'color-scheme-2'; // Default to scheme-2 if lost
      el.classList.remove(LIGHT_SCHEME);
      el.classList.add(originalScheme);
    }

    function updateThemeUI(dark) {
      const allElements = document.querySelectorAll('[class*="color-scheme-"]');

      if (dark) {
        // Switch to DARK
        document.documentElement.classList.add('strongside-dark');
        document.documentElement.classList.remove('strongside-light');
        body.classList.add('strongside-dark');
        body.classList.remove('strongside-light');

        allElements.forEach((el) => removeLightSchemeFromElement(el));

        if (sunIcon) sunIcon.style.display = 'block';
        if (moonIcon) moonIcon.style.display = 'none';
        if (themeTextMobile) themeTextMobile.textContent = 'LIGHT MODE';
      } else {
        // Switch to LIGHT
        document.documentElement.classList.remove('strongside-dark');
        document.documentElement.classList.add('strongside-light');
        body.classList.remove('strongside-dark');
        body.classList.add('strongside-light');

        allElements.forEach((el) => applyLightSchemeToElement(el));

        if (sunIcon) sunIcon.style.display = 'none';
        if (moonIcon) moonIcon.style.display = 'block';
        if (themeTextMobile) themeTextMobile.textContent = 'DARK MODE';
      }
    }

    // Initialize
    // We need to wait a moment for Shopify sections to render purely to be safe,
    // but running immediately is standard.
    updateThemeUI(isDark);

    // Observer to handle dynamically injected elements (like Cart Drawer)
    const observer = new MutationObserver((mutations) => {
      if (localStorage.getItem('theme') !== 'dark') {
        mutations.forEach((mutation) => {
          mutation.addedNodes.forEach((node) => {
            if (node.nodeType === 1) {
              // Element
              if (node.matches && node.matches('[class*="color-scheme-"]')) {
                applyLightSchemeToElement(node);
              }
              // Also check children
              const children = node.querySelectorAll('[class*="color-scheme-"]');
              children.forEach((child) => applyLightSchemeToElement(child));
            }
          });
        });
      }
    });

    observer.observe(document.body, { childList: true, subtree: true });

    function toggleTheme() {
      const isCurrentlyDark = body.classList.contains('strongside-dark');
      if (isCurrentlyDark) {
        localStorage.setItem('theme', 'light');
        updateThemeUI(false);
      } else {
        localStorage.setItem('theme', 'dark');
        updateThemeUI(true);
      }
    }

    if (toggleBtn) toggleBtn.addEventListener('click', toggleTheme);
    if (toggleBtnMobile) toggleBtnMobile.addEventListener('click', toggleTheme);
  });
</script>

{% schema %}
{
  "name": "Strongside Header",
  "settings": [
    {
      "type": "header",
      "content": "Custom Header"
    }
  ]
}
{% endschema %}
