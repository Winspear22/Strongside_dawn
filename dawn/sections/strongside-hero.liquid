{% comment %}
  STRONGSIDE Product Hero - Exact React Replica
{% endcomment %}

{%- assign product = section.settings.product -%}

{%- comment -%} SMART AUTO-SELECT LOGIC: Find product with "Harness" in title if not selected {%- endcomment -%}
{%- if product == blank -%}
  {%- for p in collections.all.products -%}
    {%- assign title_down = p.title | downcase -%}
    {%- if title_down contains 'harness' or title_down contains 'harnais' -%}
      {%- assign product = p -%}
      {%- break -%}
    {%- endif -%}
  {%- endfor -%}
{%- endif -%}

{%- comment -%} Fallback to specific handle or first product if still not found {%- endcomment -%}

<style>
  /* 
    CONTAINER GLOBAL
    Uses Shopify Native Variables for Background/Foreground
  */
  .strongside-hero {
    min-height: 100vh;
    background: rgb(var(--color-background));
    color: rgb(var(--color-foreground));
    font-family: var(--font-body-family);
  }

  /* 
    LAYOUT DE LA SECTION (GRID/FLEX)
  */
  .strongside-hero-container {
    display: flex;
    flex-direction: column;
    padding-top: 6.5rem !important; /* Increased from 5.1rem to clear header on mobile */
  }

  @media (min-width: 1024px) {
    .strongside-hero-container {
      flex-direction: row;
    }
  }

  /* 
    COLONNE GAUCHE (GALERIE IMAGES)
    Adapted to use transparent dark overlay for contrast in both modes
  */
  .strongside-gallery-col {
    width: 100%;
    background: rgba(var(--color-foreground), 0.05); /* Adaptive slight gray */
    position: relative;
  }

  @media (min-width: 1024px) {
    .strongside-gallery-col {
      width: 55%;
    }
  }

  .strongside-gallery-sticky {
    padding: 1rem;
  }

  @media (min-width: 1024px) {
    .strongside-gallery-sticky {
      position: sticky;
      top: 4rem;
      padding: 1.5rem;
    }
  }

  .strongside-gallery-grid {
    display: flex;
    gap: 1rem;
  }

  .strongside-thumbs-desktop {
    display: none;
    flex-direction: column;
    gap: 0.5rem;
    max-height: 70vh;
    overflow-y: auto;
    -ms-overflow-style: none;
    scrollbar-width: none;
  }

  .strongside-thumbs-desktop::-webkit-scrollbar {
    display: none;
  }

  @media (min-width: 1024px) {
    .strongside-thumbs-desktop {
      display: flex;
    }
  }

  .strongside-thumb-btn {
    width: 9rem;
    height: 9rem;
    border-radius: 0.5rem;
    overflow: hidden;
    background: transparent !important;
    border: none !important;
    opacity: 0.7;
    transition: all 0.2s;
    cursor: pointer;
    flex-shrink: 0;
  }

  .strongside-thumb-btn img {
    object-fit: contain !important;
    width: 100%;
    height: 100%;
  }

  .strongside-thumb-btn:hover {
    border-color: rgba(var(--color-foreground), 0.3);
    opacity: 1;
  }

  .strongside-thumb-btn.is-active {
    border-color: #ff2222;
    box-shadow: 0 0 0 2px rgba(255, 34, 34, 0.3);
    transform: scale(1.05);
    opacity: 1;
  }

  .strongside-main-image-container {
    flex: 1;
    aspect-ratio: 1/1;
    position: relative;
    overflow: hidden;
    border-radius: 1rem;
    background: rgba(var(--color-foreground), 0.05);
    cursor: zoom-in;
  }

  .strongside-main-image {
    width: 100%;
    height: 100%;
    object-fit: contain;
    transition: opacity 0.3s;
  }

  .strongside-zoom-hint {
    position: absolute;
    inset: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    background-color: rgba(0, 0, 0, 0);
    transition: background-color 0.3s;
    pointer-events: none;
  }

  .strongside-main-image-container:hover .strongside-zoom-hint {
    background-color: rgba(0, 0, 0, 0.2);
  }

  .strongside-zoom-label {
    opacity: 0;
    transition: opacity 0.3s;
    background-color: rgba(var(--color-foreground), 0.8);
    color: rgb(var(--color-background));
    padding: 0.25rem 0.75rem;
    border-radius: 9999px;
    font-size: 0.875rem;
  }

  .strongside-main-image-container:hover .strongside-zoom-label {
    opacity: 1;
  }

  .strongside-thumbs-mobile {
    display: flex;
    gap: 0.5rem;
    overflow-x: auto;
    padding-bottom: 0.5rem;
    margin-top: 0.5rem;
    -ms-overflow-style: none;
    scrollbar-width: none;
  }

  .strongside-thumbs-mobile .strongside-thumb-btn {
    width: 4.5rem !important;
    height: 4.5rem !important;
    flex-shrink: 0;
  }

  @media (min-width: 1024px) {
    .strongside-thumbs-mobile {
      display: none;
    }
  }

  /* 
    COLONNE DROITE (INFOS PRODUIT)
  */
  .strongside-info-col {
    width: 100%;
    background: transparent; /* Inherits main wrapper background */
    padding: 1rem;
    display: flex;
    flex-direction: column;
  }

  @media (min-width: 1024px) {
    .strongside-info-col {
      width: 45%;
      padding: 4rem;
    }
  }

  .strongside-info-sticky {
    padding-top: 1rem;
  }

  /* 
    OVERRIDES TYPOGRAPHIE GLOBALE
  */
  .strongside-hero-container,
  #strongside-hero-wrapper .strongside-product-title,
  #strongside-hero-wrapper .strongside-desc-toggle,
  #strongside-hero-wrapper .strongside-desc-toggle span,
  #strongside-hero-wrapper .strongside-price-container,
  #strongside-hero-wrapper .strongside-reviews-badge,
  #strongside-hero-wrapper .strongside-variant-label,
  #strongside-hero-wrapper .strongside-variant-btn,
  #strongside-hero-wrapper .strongside-btn-add,
  #strongside-hero-wrapper .strongside-btn-buy,
  #strongside-hero-wrapper .strongside-trust-item,
  #strongside-hero-wrapper .strongside-accordion-btn {
    font-family: ui-sans-serif, system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue',
      Arial, 'Noto Sans', sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji' !important;
  }

  .strongside-hero-container {
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
  }

  #strongside-hero-wrapper .strongside-product-title {
    font-family: 'Inter', system-ui, sans-serif !important;
    font-size: 3.6rem !important;
    line-height: 0.9 !important;
    font-weight: 900 !important;
    font-style: italic !important;
    text-transform: uppercase !important;
    letter-spacing: -0.05em !important;
    color: rgb(var(--color-foreground)) !important;
    margin-bottom: 2.4rem !important;
    text-shadow: none !important; /* Removed text shadow for cleaner look in light mode, or use opacity */
  }

  @media (min-width: 1024px) {
    #strongside-hero-wrapper .strongside-product-title {
      font-size: 6rem !important;
      margin-bottom: 3.2rem;
    }
  }

  #strongside-hero-wrapper .strongside-desc-toggle {
    width: 100%;
    margin-bottom: 0.5rem;
    padding: 1.25rem 1.6rem;
    background-color: rgba(var(--color-foreground), 0.05);
    border: 1px solid rgba(var(--color-foreground), 0.1);
    border-radius: 0.5rem;
    display: flex;
    align-items: center;
    justify-content: space-between;
    cursor: pointer;
    transition: all 0.2s;
    color: rgb(var(--color-foreground));
    font-family: inherit;
  }

  #strongside-hero-wrapper .strongside-desc-toggle:hover {
    background-color: rgba(var(--color-foreground), 0.1);
  }

  #strongside-hero-wrapper .strongside-desc-toggle span {
    font-size: 1.2rem;
    line-height: 1.5rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: rgb(var(--color-foreground));
  }

  #strongside-hero-wrapper #desc-arrow {
    width: 1.6rem;
    height: 1.6rem;
    transition: transform 0.3s;
    display: flex;
    align-items: center;
    color: rgba(var(--color-foreground), 0.6);
  }

  #strongside-hero-wrapper .strongside-price-container {
    display: flex;
    align-items: baseline;
    gap: 1.2rem;
    margin-bottom: 1rem;
  }

  #strongside-hero-wrapper .strongside-price-main {
    font-size: 3.6rem;
    font-weight: 900;
    color: rgb(var(--color-foreground)) !important;
  }

  #strongside-hero-wrapper .strongside-price-currency {
    font-size: 2rem;
    font-weight: 400;
    color: rgba(var(--color-foreground), 0.6);
  }

  #strongside-hero-wrapper .strongside-price-compare {
    font-size: 2.4rem;
    color: rgba(var(--color-foreground), 0.6);
    text-decoration: line-through;
  }

  #strongside-hero-wrapper .strongside-discount-badge {
    background: #ff2222;
    color: white;
    padding: 0.4rem 0.8rem;
    border-radius: 9999px;
    font-size: 1.4rem;
    font-weight: 700;
  }

  #strongside-hero-wrapper .strongside-reviews-badge {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    background: rgba(var(--color-foreground), 0.05);
    padding: 0.8rem 1.6rem;
    border-radius: 9999px;
    border: 1px solid rgba(var(--color-foreground), 0.1);
    cursor: pointer;
    margin-bottom: 2.4rem;
    transition: all 0.2s;
  }

  #strongside-hero-wrapper .strongside-reviews-badge:hover {
    background: rgba(var(--color-foreground), 0.1);
  }

  #strongside-hero-wrapper .strongside-stars {
    color: #facc15;
    display: flex;
    gap: 2px;
  }

  #strongside-hero-wrapper .strongside-variants {
    margin-bottom: 2.4rem;
  }

  #strongside-hero-wrapper .strongside-variant-label {
    font-size: 1.2rem;
    color: rgba(var(--color-foreground), 0.6);
    text-transform: uppercase;
    letter-spacing: 0.05em;
    margin-bottom: 0.8rem;
    display: block;
    font-weight: 700;
  }

  #strongside-hero-wrapper .strongside-variant-btn {
    border: 1px solid rgba(var(--color-foreground), 0.2);
    background: transparent;
    color: rgba(var(--color-foreground), 0.6);
    padding: 1rem 2rem;
    font-size: 1.2rem;
    border-radius: 9999px;
    cursor: pointer;
    transition: all 0.2s;
    font-weight: 700;
    text-transform: uppercase;
  }

  #strongside-hero-wrapper .strongside-variant-btn.is-selected {
    background: rgb(var(--color-foreground));
    color: rgb(var(--color-background));
    border-color: rgb(var(--color-foreground));
  }

  #strongside-hero-wrapper .strongside-actions {
    display: flex;
    flex-direction: column;
    gap: 1.2rem;
    margin-bottom: 2.4rem;
  }

  @media (min-width: 1024px) {
    #strongside-hero-wrapper .strongside-actions {
      gap: 1.6rem;
      margin-bottom: 4rem;
    }
  }

  #strongside-hero-wrapper .strongside-btn-add {
    width: 100%;
    padding: 2rem;
    background-color: white !important; /* Always white */
    color: black !important; /* Always black text */
    font-size: 2rem !important;
    font-weight: 900 !important;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    border-radius: 9999px;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 1.2rem;
    cursor: pointer;
    transition: all 0.2s;
    border: 1px solid rgba(255, 255, 255, 0.1);
  }

  /* Force child elements (SVG, Text) to be black */
  #strongside-hero-wrapper .strongside-btn-add *,
  #strongside-hero-wrapper .strongside-btn-add span {
    color: black !important;
  }

  /* SVG Specific: Outline Style (Stroke only, No fill) */
  #strongside-hero-wrapper .strongside-btn-add svg {
    fill: none !important;
    stroke: black !important;
    stroke-width: 2px !important;
  }
  #strongside-hero-wrapper .strongside-btn-add svg path {
    fill: none !important;
    stroke: black !important;
  }

  #strongside-hero-wrapper .strongside-btn-add:hover {
    opacity: 0.9;
  }

  #strongside-hero-wrapper .strongside-btn-buy {
    width: 100%;
    padding: 1.6rem;
    background-color: #10b981 !important;
    color: white !important; /* Keep white for green button */
    font-size: 1.8rem !important;
    font-weight: 900 !important;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    border-radius: 9999px;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 1.2rem;
    cursor: pointer;
    transition: all 0.2s;
    box-shadow: 0 10px 15px -3px rgba(16, 185, 129, 0.3);
    border: none;
  }

  #strongside-hero-wrapper .strongside-btn-buy:hover {
    background-color: #059669 !important;
  }

  #strongside-hero-wrapper .strongside-trust-text {
    font-weight: 400 !important;
    font-size: 1rem;
    letter-spacing: 0.1em;
    text-transform: uppercase;
  }

  #strongside-hero-wrapper .strongside-trust-text-container {
    display: flex;
    flex-direction: row;
    flex-wrap: wrap;
    align-items: center;
    justify-content: center;
    gap: 1.5rem;
    margin-bottom: 0.5rem;
    width: 100%;
  }

  #strongside-hero-wrapper .strongside-trust-item {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-family: 'ui-sans-serif', system-ui, sans-serif !important;
    font-size: 1.5rem !important;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    color: rgba(var(--color-foreground), 0.6);
    font-weight: 600;
    transition: color 0.2s;
  }

  @media (min-width: 1024px) {
    #strongside-hero-wrapper .strongside-trust-text-container {
      gap: 2rem;
    }
    #strongside-hero-wrapper .strongside-trust-item {
      font-size: 1.5rem !important;
    }
  }

  #strongside-hero-wrapper .strongside-trust-logos {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 1.5rem;
    margin-top: 1rem;
  }

  #strongside-hero-wrapper .strongside-trust-logo-img {
    height: 7rem !important;
    width: auto !important;
    max-width: 112px !important;
    object-fit: contain;
    opacity: 0.7;
    transition: opacity 0.2s;
    /* Invert colors in light mode? No, payment logos usually have fixed colors or work on white. 
       If they are white PNGs, they will disappear on white background.
       We might need filter: invert(1) in light mode if they are white.
       Assuming they are colored or white. */
    /* Removing filters to show original colored logos in both modes */
    filter: none;
  }

  #strongside-hero-wrapper .strongside-trust-logo-img:hover {
    opacity: 1;
  }

  #strongside-hero-wrapper .strongside-accordion {
    border-bottom: 1px solid rgba(var(--color-foreground), 0.1);
  }

  #strongside-hero-wrapper .strongside-accordion:first-child {
    border-top: 1px solid rgba(var(--color-foreground), 0.1);
  }

  #strongside-hero-wrapper .strongside-accordion-btn {
    width: 100%;
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 1.5rem 0;
    background: transparent;
    border: none;
    color: rgb(var(--color-foreground));
    font-size: 1.2rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    cursor: pointer;
    transition: color 0.2s;
  }

  #strongside-hero-wrapper .strongside-accordion-btn:hover {
    color: #ff2222;
  }

  #strongside-hero-wrapper .strongside-accordion-content {
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.3s ease-out;
    color: rgba(var(--color-foreground), 0.7);
    font-size: 1.5rem;
    line-height: 1.6;
  }

  #strongside-hero-wrapper .strongside-accordion-content.is-open {
    max-height: 500px;
    padding-bottom: 1.25rem;
  }

  /* Hero Video Carousel Navigation Buttons */
  .hero-nav-btn {
    width: 3.25rem;
    height: 3.25rem;
    border-radius: 9999px;
    background-color: #1a1a1a !important; /* Always dark */
    border: none;
    color: #ffffff !important; /* Always white icon */
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: background-color 0.2s;
  }

  .hero-nav-btn svg {
    stroke: #ffffff !important;
  }

  .hero-nav-btn:hover {
    background-color: #333333 !important;
  }

  .hero-nav-btn:hover svg {
    stroke: #ff2222 !important;
  }
</style>

<div class="strongside-hero color-{{ section.settings.color_scheme }} gradient" id="strongside-hero-wrapper">
  <div class="strongside-hero-container">
    <!-- LEFT COLUMN -->
    <div class="strongside-gallery-col">
      <div class="strongside-gallery-sticky">
        <div class="strongside-gallery-grid">
          <!-- Desktop Thumbs -->
          <div class="strongside-thumbs-desktop">
            {% for media in product.media %}
              <button
                class="strongside-thumb-btn {% if forloop.first %}is-active{% endif %}"
                onclick="goToImageIndex({{ forloop.index0 }})"
              >
                <img
                  src="{{ media | image_url: width: 200 }}"
                  width="200"
                  height="{{ 200 | divided_by: media.preview_image.aspect_ratio | ceil }}"
                  alt="{{ media.alt | escape }}"
                  class="w-full h-full object-cover"
                >
              </button>
            {% endfor %}
          </div>

          <!-- Main Image Track -->
          <div
            class="strongside-main-image-container"
            id="hero-main-image-container"
            onclick="openHeroModalWithIndex()"
            style="overflow:hidden;"
          >
            <div
              id="hero-image-track"
              style="display:flex; height:100%; transition:transform 0.3s ease-out; will-change:transform; backface-visibility:hidden; -webkit-backface-visibility:hidden;"
            >
              {% for media in product.media %}
                <div style="width:100%; height:100%; flex-shrink:0; display:flex; align-items:center; justify-content:center;">
                  <img
                    src="{{ media | image_url: width: 1200 }}"
                    class="strongside-main-image"
                    style="width:100%; height:100%; object-fit:contain;"
                    draggable="false"
                    loading="eager"
                    fetchpriority="high"
                    decoding="sync"
                  >
                </div>
              {% endfor %}
            </div>
          </div>
        </div>

        <!-- Mobile Thumbs -->
        <div class="strongside-thumbs-mobile">
          {% for media in product.media %}
            <button
              class="strongside-thumb-btn {% if forloop.first %}is-active{% endif %}"
              style="width:3rem;height:3rem;"
              onclick="goToImageIndex({{ forloop.index0 }})"
            >
              <img
                src="{{ media | image_url: width: 200 }}"
                class="w-full h-full object-cover"
                width="200"
                height="200"
              >
            </button>
          {% endfor %}
        </div>
      </div>
    </div>

    <!-- RIGHT COLUMN -->
    <div class="strongside-info-col">
      <div class="strongside-info-sticky">
        <!-- REMOVED: Pro/Essentials Tabs -->

        <!-- Title -->
        <h1 class="strongside-product-title">{{ product.title }}</h1>

        <!-- Description Toggle -->
        <button class="strongside-desc-toggle" onclick="toggleDescription()">
          <span>{{ 'strongside.shop.showDetails' | t }}</span>
          <div id="desc-arrow">
            <svg width="100%" height="100%" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
            </svg>
          </div>
        </button>

        <div
          id="desc-content"
          class="strongside-desc-content"
          style="overflow:hidden;max-height:0;transition:max-height 0.3s ease-out; font-family: ui-sans-serif, system-ui, -apple-system, sans-serif; -webkit-font-smoothing: antialiased;"
        >
          <div class="prose prose-invert strongside-desc-body">
            <style>
              /* React Mobile: text-sm (14px) */
              /* Force font size larger to 1.2rem (approx 19px) to be clearly visible */
              .strongside-desc-body {
                font-size: 1.25rem !important;
                line-height: 1.6;
                color: #d1d5db;
                padding-top: 1rem;
              }
              .strongside-desc-body h3 {
                font-size: 1.125rem;
                font-weight: 800;
                text-transform: uppercase;
                color: white;
                margin-top: 1.5rem;
                margin-bottom: 0.5rem;
                letter-spacing: 0.05em;
                line-height: 1.4;
              }
              .strongside-desc-body h4 {
                font-size: 1rem;
                font-weight: 700;
                color: white;
                margin-top: 1rem;
                margin-bottom: 0.5rem;
                line-height: 1.4;
              }
              .strongside-desc-body p {
                margin-bottom: 1em;
              }
              .strongside-desc-body ul {
                list-style: disc;
                margin-left: 1.2rem;
                margin-bottom: 1em;
                color: #9ca3af;
              }
              .strongside-desc-body li {
                margin-bottom: 0.25em;
              }
              .strongside-desc-body strong {
                color: white;
                font-weight: 700;
              }
              .strongside-desc-body em {
                color: #d1d5db;
                font-style: italic;
              }

              /* React Desktop: text-base (16px) */
              @media (min-width: 1024px) {
                .strongside-desc-body {
                  font-size: 1rem;
                  line-height: 1.75;
                }
                .strongside-desc-body h3 {
                  font-size: 1.25rem;
                }
                .strongside-desc-body h4 {
                  font-size: 1.125rem;
                }
              }
            </style>
            {% if product.description != blank %}
              {{ product.description }}
            {% else %}
              <h3>{{ 'strongside.shop.features.title' | t }}</h3>
              <p>Conçu pour sculpter votre puissance de frappe. <strong>MORE RESISTANCE MORE POWER.</strong></p>
              <p>
                Conçu pour le Shadow Boxing, le travail au sac, les pads, les paos et le conditionnement physique
                global.
              </p>

              <p>
                <em>Un équipement sports de combat unique, conçu et disponible exclusivement sur strongside.tech</em>
              </p>

              <h3>{{ 'strongside.shop.whatYouGet.title' | t }} :</h3>
              <h4>1. STRONGSIDE Pro Boxing Harness (Ajustable)</h4>
              <ul>
                <li>Conception ergonomique pour un maintien parfait sans gêner les mouvements.</li>
                <li>Matériaux haute résistance.</li>
              </ul>
            {% endif %}
          </div>
        </div>

        <!-- Price -->
        <div class="strongside-price-container">
          <span class="strongside-price-main">{{ product.price | money_without_trailing_zeros }}</span>
          {% if product.compare_at_price > product.price %}
            <span class="strongside-price-compare">{{ product.compare_at_price | money_without_trailing_zeros }}</span>
            <span class="strongside-discount-badge"
              >-
              {{-
                product.compare_at_price
                | minus: product.price
                | times: 100.0
                | divided_by: product.compare_at_price
                | round
              -}}
              %</span
            >
          {% endif %}
        </div>

        <!-- Reviews Badge -->
        <button
          class="strongside-reviews-badge"
          style="display:flex; align-items:center; gap:0.5rem; background:rgba(255,255,255,0.05); padding:0.8rem 1.6rem; border-radius:9999px; border:1px solid rgba(255,255,255,0.1); cursor:pointer; margin-bottom:2.4rem; transition:all 0.2s;"
          onmouseover="this.style.background='rgba(255,255,255,0.1)'"
          onmouseout="this.style.background='rgba(255,255,255,0.05)'"
          onclick="const el = document.getElementById('customer-reviews'); if(el) el.scrollIntoView({behavior:'smooth'});"
        >
          <div style="color:#facc15; display:flex; gap:2px;">
            <!-- 5 Stars SVG -->
            <svg class="w-4 h-4" width="20" height="20" fill="currentColor" viewBox="0 0 20 20">
              <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
            </svg>
            <svg class="w-4 h-4" width="20" height="20" fill="currentColor" viewBox="0 0 20 20">
              <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
            </svg>
            <svg class="w-4 h-4" width="20" height="20" fill="currentColor" viewBox="0 0 20 20">
              <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
            </svg>
            <svg class="w-4 h-4" width="20" height="20" fill="currentColor" viewBox="0 0 20 20">
              <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
            </svg>
            <svg class="w-4 h-4" width="20" height="20" fill="currentColor" viewBox="0 0 20 20">
              <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
            </svg>
          </div>
          <span style="font-size:1.4rem; color:#9ca3af; font-family:'Inter',sans-serif; margin-left:1rem;">
            {{- 'strongside.shop.readComments' | t }} 9 {{ 'strongside.shop.commentsWord' | t -}}
          </span>
          <svg width="20" height="20" fill="none" stroke="#9ca3af" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
          </svg>
        </button>

        <!-- Variants -->
        {% unless product.has_only_default_variant %}
          <div class="strongside-variants">
            <label class="strongside-variant-label" style="font-size:1.2rem; font-family:'Inter', sans-serif;">
              {{- 'strongside.shop.selectOption' | t -}}
            </label>
            <div class="flex flex-wrap gap-2">
              {% for variant in product.variants %}
                <button
                  class="strongside-variant-btn {% if forloop.first %}is-selected{% endif %}"
                  data-variant-id="{{ variant.id }}"
                  onclick="selectVariant(this, '{{ variant.id }}', '{{ variant.price | money }}')"
                  style="border:1px solid {% if forloop.first %}white{% else %}rgba(255,255,255,0.2){% endif %}; background:{% if forloop.first %}white{% else %}transparent{% endif %}; color:{% if forloop.first %}black{% else %}#9ca3af{% endif %}; padding:1rem 2rem; font-size:1.2rem; font-family:'Inter',sans-serif;"
                >
                  {{ variant.title }}
                </button>
              {% endfor %}
            </div>
          </div>
        {% endunless %}

        <!-- Actions -->
        <!-- Actions with Native <product-form> for AJAX Drawer & Analytics -->
        <script src="{{ 'product-form.js' | asset_url }}" defer="defer"></script>
        {%- assign product_form_id = 'product-form-' | append: section.id -%}

        {% if product %}
          <product-form class="product-form">
            <div class="product-form__error-message-wrapper" role="alert" hidden>
              <svg aria-hidden="true" focusable="false" class="icon icon-error" viewBox="0 0 13 13">
                <circle cx="6.5" cy="6.50049" r="5.5" stroke="white" stroke-width="2"/>
                <circle cx="6.5" cy="6.5" r="5.5" fill="#EB001B" stroke="#EB001B" stroke-width="0.7"/>
                <path d="M5.87413 3.52832L5.97439 7.57216H7.02713L7.12739 3.52832H5.87413ZM6.50076 9.66091C6.88091 9.66091 7.18169 9.37267 7.18169 9.00504C7.18169 8.63742 6.88091 8.34917 6.50076 8.34917C6.12061 8.34917 5.81982 8.63742 5.81982 9.00504C5.81982 9.37267 6.12061 9.66091 6.50076 9.66091Z" fill="white"/>
                <path d="M5.87413 3.17832H5.51535L5.52424 3.537L5.6245 7.58083L5.63296 7.92216H5.97439H7.02713H7.36856L7.37702 7.58083L7.47728 3.537L7.48617 3.17832H7.12739H5.87413ZM6.50076 10.0109C7.06121 10.0109 7.5317 9.57872 7.5317 9.00504C7.5317 8.43137 7.06121 7.99918 6.50076 7.99918C5.94031 7.99918 5.46982 8.43137 5.46982 9.00504C5.46982 9.57872 5.94031 10.0109 6.50076 10.0109Z" fill="white" stroke="#EB001B" stroke-width="0.7"/>
              </svg>
              <span class="product-form__error-message"></span>
            </div>

            {% form 'product',
              product,
              id: product_form_id,
              class: 'form',
              novalidate: 'novalidate',
              data-type: 'add-to-cart-form'
            %}
              <input type="hidden" name="id" value="{{ product.selected_or_first_available_variant.id }}">

              <div class="strongside-actions">
                <!-- ADD TO CART: Secondary (White) -->
                <button
                  type="submit"
                  name="add"
                  class="strongside-btn-add"
                  style="background-color:white !important; color:black !important; border:none !important; width:100%; border-radius:9999px; font-weight:900; text-transform:uppercase; padding:1.25rem;"
                >
                  <span class="loading__spinner hidden">
                    <svg
                      aria-hidden="true"
                      focusable="false"
                      class="spinner"
                      viewBox="0 0 66 66"
                      xmlns="http://www.w3.org/2000/svg"
                    >
                      <circle class="path" fill="none" stroke-width="6" cx="33" cy="33" r="30"></circle>
                    </svg>
                  </span>
                  <span class="btn-text">
                    <svg
                      style="width:32px;height:32px;display:inline-block;vertical-align:middle;margin-right:0.5rem;"
                      fill="none"
                      viewBox="0 0 24 24"
                      stroke="currentColor"
                    >
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z" />
                    </svg>
                    {{ 'strongside.shop.addToCart' | t }}
                  </span>
                </button>

                <!-- BUY NOW: Primary (Green) - Still uses direct checkout usually, but kept in form -->
                <button
                  type="submit"
                  name="add"
                  class="strongside-btn-buy"
                  style="background-color:#10b981 !important; color:white !important; border:none !important; width:100%; border-radius:9999px; font-weight:900; text-transform:uppercase; padding:1rem; box-shadow: 0 10px 15px -3px rgba(16, 185, 129, 0.3);"
                >
                  <svg style="width:28px;height:28px;" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
                  </svg>
                  {{ 'strongside.shop.buyNow' | t }}
                </button>
              </div>
            {% endform %}
          </product-form>
        {% else %}
          <div style="padding: 2rem; border: 1px dashed red; color: red;">PRODUIT NON TROUVÉ</div>
        {% endif %}

        <!-- Trust Badges -->
        <div class="flex flex-col items-center justify-center gap-4 mt-6 mb-6">
          <div class="strongside-trust-text-container">
            <span class="strongside-trust-item">
              <svg style="width:20px;height:20px;color:#10b981;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
              </svg>
              {{ 'strongside.shop.fastShipping' | t }}
            </span>
            <span class="strongside-trust-item">
              <svg style="width:20px;height:20px;color:#9ca3af;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" />
              </svg>
              {{ 'strongside.shop.warranty' | t }}
            </span>
            <span class="strongside-trust-item">
              <svg style="width:20px;height:20px;color:#9ca3af;" fill="currentColor" viewBox="0 0 24 24">
                <path d="M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4zm0 10.99h7c-.53 4.12-3.28 7.79-7 8.94V12H5V6.3l7-3.11v8.8z" />
              </svg>
              {{ 'strongside.shop.securePayment' | t }}
            </span>
          </div>
          <div class="strongside-trust-logos">
            <img
              src="{{ 'visa mastercard.webp' | asset_url }}"
              alt="Visa Mastercard"
              class="strongside-trust-logo-img"
              width="40"
              height="25"
            >
            <img
              src="{{ 'paypal logo.webp' | asset_url }}"
              alt="PayPal"
              class="strongside-trust-logo-img"
              width="40"
              height="25"
            >
            <img
              src="{{ 'cb logo.webp' | asset_url }}"
              alt="CB"
              class="strongside-trust-logo-img"
              width="40"
              height="25"
            >
          </div>
        </div>
      </div>

      <!-- Accordions -->
      <div class="border-t border-white/10 pt-4 mt-6">
        <!-- Accordion 1: Pack Content -->
        <div class="strongside-accordion">
          <button class="strongside-accordion-btn" onclick="toggleAccordion(this)">
            {{ 'strongside.shop.packContent' | t }}
            <span class="plus-icon">+</span>
          </button>
          <div class="strongside-accordion-content">
            {% if product.metafields.custom.contenu_du_pack != blank %}
              {{ product.metafields.custom.contenu_du_pack | metafield_tag }}
            {% else %}
              {{ 'strongside.shop.packContentList_html' | t }}
            {% endif %}
          </div>
        </div>

        <!-- Accordion 2: Shipping -->
        <div class="strongside-accordion">
          <button class="strongside-accordion-btn" onclick="toggleAccordion(this)">
            {{ 'strongside.shop.shippingTitle' | t }}
            <span class="plus-icon">+</span>
          </button>
          <div class="strongside-accordion-content">
            {% if product.metafields.custom.livraison_et_retours != blank %}
              {{ product.metafields.custom.livraison_et_retours | metafield_tag }}
            {% else %}
              {{ 'strongside.shop.shippingContent_html' | t }}
            {% endif %}
          </div>
        </div>

        <!-- Accordion 3: Warranty -->
        <div class="strongside-accordion">
          <button class="strongside-accordion-btn" onclick="toggleAccordion(this)">
            {{ 'strongside.shop.guaranteeTitle' | t }}
            <span class="plus-icon">+</span>
          </button>
          <div class="strongside-accordion-content">
            {% if product.metafields.custom.garantie != blank %}
              {{ product.metafields.custom.garantie | metafield_tag }}
            {% else %}
              {{ 'strongside.shop.guaranteeContent_html' | t }}
            {% endif %}
          </div>
        </div>
      </div>

      <!-- INTEGRATED VIDEO CAROUSEL -->
      <div
        class="strongside-hero-videos"
        style="margin-top:2rem; padding-top:1.5rem; border-top:1px solid rgba(255,255,255,0.1);"
      >
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:1rem;">
          <h3 style="font-size:1.25rem; font-weight:700; color:white; text-transform:uppercase; letter-spacing:0.1em; margin:0;">
            {{ 'strongside.training.cta.title' | t }}
          </h3>
          <div style="display:flex; gap:0.5rem;">
            <button
              id="hero-vid-prev"
              style="width:3.25rem;height:3.25rem;border-radius:9999px;background:#1a1a1a;display:flex;align-items:center;justify-content:center;color:white;border:none;cursor:pointer;transition:background 0.2s;"
              onmouseover="this.style.background='#333333'; this.querySelector('svg').style.stroke='#ff2222';"
              onmouseout="this.style.background='#1a1a1a'; this.querySelector('svg').style.stroke='white';"
            >
              <svg
                width="24"
                height="24"
                fill="none"
                stroke="white"
                viewBox="0 0 24 24"
                style="stroke:white; transition:stroke 0.2s;"
              >
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
              </svg>
            </button>
            <button
              id="hero-vid-next"
              style="width:3.25rem;height:3.25rem;border-radius:9999px;background:#1a1a1a;display:flex;align-items:center;justify-content:center;color:white;border:none;cursor:pointer;transition:background 0.2s;"
              onmouseover="this.style.background='#333333'; this.querySelector('svg').style.stroke='#ff2222';"
              onmouseout="this.style.background='#1a1a1a'; this.querySelector('svg').style.stroke='white';"
            >
              <svg
                width="24"
                height="24"
                fill="none"
                stroke="white"
                viewBox="0 0 24 24"
                style="stroke:white; transition:stroke 0.2s;"
              >
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
              </svg>
            </button>
          </div>
        </div>

        <div class="strongside-hero-carousel" style="overflow:hidden; margin-bottom:1rem;">
          <div id="hero-video-track" style="display:flex; gap:1.05rem; transition:transform 0.3s ease-out;">
            <!-- JS Injected -->
          </div>
        </div>

        <div id="hero-video-dots" style="display:flex; justify-content:center; gap:0.3rem;"></div>
      </div>

      <!-- Mobile Modal markup (Video) -->
      <div
        id="hero-mobile-modal"
        class="strongside-mobile-modal"
        style="display:none; position:fixed; inset:0; z-index:9999; background:black;"
      >
        <button
          id="hero-modal-close"
          style="position:absolute; top:7rem; left:1rem; z-index:50; width:2.5rem; height:2.5rem; border-radius:50%; background:rgba(0,0,0,0.5); color:white; border:1px solid rgba(255,255,255,0.2); display:flex; align-items:center; justify-content:center; cursor:pointer;"
        >
          <svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
          </svg>
        </button>
        <div
          id="hero-modal-scroller"
          style="width:100%; height:100%; overflow-y:scroll; scroll-snap-type:y mandatory; -ms-overflow-style:none; scrollbar-width:none;"
        ></div>
      </div>
    </div>
  </div>
</div>

<!-- HERO ZOOM MODAL (Added) -->
<div
  id="hero-image-modal"
  class="strongside-mobile-modal"
  onclick="closeHeroModal()"
  style="display:none; position:fixed; inset:0; z-index:99999; background:rgba(0,0,0,0.95); align-items:center; justify-content:center;"
>
  <button
    onclick="closeHeroModal()"
    style="position:absolute; top:2rem; right:2rem; background:transparent; border:none; color:white; font-size:3rem; cursor:pointer;"
  >
    &times;
  </button>
  <img
    id="hero-modal-img"
    src="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw=="
    width="1000"
    height="1000"
    alt="Zoom"
    style="max-width:95vw; max-height:95vh; object-fit:contain; border-radius:0.5rem;"
    onclick="event.stopPropagation()"
  >
</div>

<script>
  /* --- PRODUCT IMAGES DATA --- */
  const heroImages = [
    {% for media in product.media %}
      "{{ media | image_url: width: 1200 }}",
    {% endfor %}
  ];
  let currentImageIndex = 0;

  // Track Logic
  const imgTrack = document.getElementById('hero-image-track');

  function goToImageIndex(index) {
    if (index < 0 || index >= heroImages.length) return;
    currentImageIndex = index;
    
    // Slide Track (GPU accelerated)
    if (imgTrack) {
        imgTrack.style.transform = `translate3d(-${index * 100}%, 0, 0)`;
    }

    // Update Thumbs (Highlight only, no scroll forcing unless mobile/necessary)
    const len = heroImages.length;
    document.querySelectorAll('.strongside-thumb-btn').forEach((b, i) => {
        // Desktop thumbs (first set) and Mobile thumbs (second set)
        // Map linearly: i % len matches current index
        const isMatch = (i % len === index);
        if (isMatch) b.classList.add('is-active');
        else b.classList.remove('is-active');

        // Scroll mobile thumb into view if active
        if (isMatch && b.parentElement.classList.contains('strongside-thumbs-mobile')) {
            b.scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'center' });
        }
    });
  }

  // --- FLUID SWIPE (Main Image) - Clean Sync Version ---
  (function() {
      if(!imgTrack) return;
      
      let isDragging = false;
      let startX = 0;
      let startTime = 0;
      let currentTranslate = 0;
      let prevTranslate = 0;

      function getClientX(e) {
        if (e.touches && e.touches.length > 0) {
          return e.touches[0].clientX;
        }
        if (e.clientX !== undefined) {
          return e.clientX;
        }
        return null;
      }

      function touchStart(e) {
          const x = getClientX(e);
          if (x === null) return;
          
          isDragging = true;
          startX = x;
          startTime = Date.now();
          prevTranslate = -currentImageIndex * 100;
          
          // Disable transition for 1:1 tracking
          imgTrack.style.transition = 'none';
      }

      function touchMove(e) {
          if (!isDragging) return;
          
          const currentX = getClientX(e);
          if (currentX === null) return;
          
          const deltaX = currentX - startX;
          const containerWidth = imgTrack.parentElement.offsetWidth;
          if (containerWidth === 0) return; // Safety
          
          const deltaPercent = (deltaX / containerWidth) * 100;
          
          currentTranslate = prevTranslate + deltaPercent;
          
          // Soft resistance at boundaries
          const maxTranslate = 0;
          const minTranslate = -(heroImages.length - 1) * 100;
          
          if (currentTranslate > maxTranslate) {
              currentTranslate = maxTranslate + (currentTranslate - maxTranslate) * 0.2;
          } else if (currentTranslate < minTranslate) {
              currentTranslate = minTranslate + (currentTranslate - minTranslate) * 0.2;
          }
          
          // Update transform directly
          imgTrack.style.transform = `translate3d(${currentTranslate}%, 0, 0)`;
      }

      function touchEnd() {
          if (!isDragging) return;
          isDragging = false;
          
          const movedPercent = currentTranslate - prevTranslate;
          const timeTaken = Date.now() - startTime;
          const velocity = Math.abs(movedPercent) / timeTaken;
          
          let newIndex = currentImageIndex;
          
          // Threshold: 25% OR velocity > 0.2
          if (movedPercent < -25 || (movedPercent < 0 && velocity > 0.2)) {
              newIndex++;
          } else if (movedPercent > 25 || (movedPercent > 0 && velocity > 0.2)) {
              newIndex--;
          }
          
          newIndex = Math.max(0, Math.min(newIndex, heroImages.length - 1));
          
          // Enable transition for smooth snap
          imgTrack.style.transition = 'transform 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94)';
          
          // Set final position
          currentImageIndex = newIndex;
          imgTrack.style.transform = `translate3d(-${currentImageIndex * 100}%, 0, 0)`;
          
          // Update thumbnails
          const len = heroImages.length;
          document.querySelectorAll('.strongside-thumb-btn').forEach((b, i) => {
              const isMatch = (i % len === currentImageIndex);
              if (isMatch) b.classList.add('is-active');
              else b.classList.remove('is-active');
              if (isMatch && b.parentElement.classList.contains('strongside-thumbs-mobile')) {
                  b.scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'center' });
              }
          });
      }

      // Attach listeners
      const container = document.getElementById('hero-main-image-container');
      if (container) {
          container.addEventListener('touchstart', touchStart, { passive: true });
          container.addEventListener('touchmove', touchMove, { passive: true });
          container.addEventListener('touchend', touchEnd);
          container.addEventListener('touchcancel', touchEnd);
      }
  })();

  function openHeroModalWithIndex() {
    const src = heroImages[currentImageIndex];
    const modalImg = document.getElementById('hero-modal-img');
    const modal = document.getElementById('hero-image-modal');

    if (src && modalImg && modal) {
      modalImg.src = src;
      modal.style.display = 'flex';
      document.body.style.overflow = 'hidden';
    }
  }

  function closeHeroModal() {
    const modal = document.getElementById('hero-image-modal');
    if (modal) {
      modal.style.display = 'none';
      document.body.style.overflow = '';
    }
  }

  function toggleDescription() {
    const desc = document.getElementById('desc-content');
    const arrow = document.getElementById('desc-arrow');
    desc.classList.toggle('is-open');
    arrow.style.transform = desc.classList.contains('is-open') ? 'rotate(180deg)' : 'rotate(0deg)';
  }

  function toggleDescription() {
    const content = document.getElementById('desc-content');
    const arrow = document.getElementById('desc-arrow');

    if (content.style.maxHeight && content.style.maxHeight !== '0px') {
      content.style.maxHeight = '0px';
      arrow.style.transform = 'rotate(0deg)';
    } else {
      content.style.maxHeight = content.scrollHeight + 'px';
      arrow.style.transform = 'rotate(180deg)';
    }
  }

  function toggleAccordion(btn) {
    const content = btn.nextElementSibling;
    const allContents = document.querySelectorAll('.strongside-accordion-content');
    const allBtns = document.querySelectorAll('.strongside-accordion-btn');

    // Close others
    allContents.forEach((c) => {
      if (c !== content) {
        c.classList.remove('is-open');
        c.style.maxHeight = '0';
      }
    });

    // Toggle current
    content.classList.toggle('is-open');
    if (content.classList.contains('is-open')) {
      content.style.maxHeight = content.scrollHeight + 'px';
      // Optional: Change + to - if needed
    } else {
      content.style.maxHeight = '0';
    }
  }

  // Auto-select first variant on load if needed
  function selectVariant(btn, id, price) {
    // Styling
    document.querySelectorAll('.strongside-variant-btn').forEach((b) => {
      b.classList.remove('is-selected');
      b.style.background = 'transparent';
      b.style.color = '#9ca3af';
      b.style.borderColor = 'rgba(255,255,255,0.2)';
    });
    btn.classList.add('is-selected');
    btn.style.background = 'white';
    btn.style.color = 'black';
    btn.style.borderColor = 'white';

    // Logic
    // Find hidden input for form
    const input = document.querySelector('input[name="id"]');
    if (input) input.value = id;

    // Update Price
    const priceDisplay = document.querySelector('.strongside-price-main');
    if (priceDisplay) priceDisplay.innerText = price;
  }

  /* --- INTEGRATED VIDEO CAROUSEL LOGIC --- */
  (function () {
    const videos = [
      { id: '1', src: "{{ '1.mp4' | asset_url }}", title: "{{ 'strongside.training.cards.card_1' | t }}" },
      { id: '2', src: "{{ '2.mp4' | asset_url }}", title: "{{ 'strongside.training.cards.card_2' | t }}" },
      { id: '3', src: "{{ '3.mp4' | asset_url }}", title: "{{ 'strongside.training.cards.card_3' | t }}" },
      { id: '4', src: "{{ '4.mp4' | asset_url }}", title: "{{ 'strongside.training.cards.card_4' | t }}" },
      { id: '5', src: "{{ '5.mp4' | asset_url }}", title: "{{ 'strongside.training.cards.card_5' | t }}" },
      { id: '6', src: "{{ '6.mp4' | asset_url }}", title: "{{ 'strongside.training.cards.card_6' | t }}" },
      { id: '7', src: "{{ '7.mp4' | asset_url }}", title: "{{ 'strongside.training.cards.card_7' | t }}" },
      { id: '8', src: "{{ '8.mp4' | asset_url }}", title: "{{ 'strongside.training.cards.card_8' | t }}" },
      { id: '9', src: "{{ '9.mp4' | asset_url }}", title: "{{ 'strongside.training.cards.card_9' | t }}" },
      { id: '10', src: "{{ '10.mp4' | asset_url }}", title: "{{ 'strongside.training.cards.card_10' | t }}" },
      { id: '11', src: "{{ '11.mp4' | asset_url }}", title: "{{ 'strongside.training.cards.card_11' | t }}" },
      { id: '12', src: "{{ '12.mp4' | asset_url }}", title: "{{ 'strongside.training.cards.card_12' | t }}" },
      { id: '13', src: "{{ '13.mp4' | asset_url }}", title: "{{ 'strongside.training.cards.card_13' | t }}" },
    ];

    const track = document.getElementById('hero-video-track');
    const pagination = document.getElementById('hero-video-dots');
    const btnPrev = document.getElementById('hero-vid-prev');
    const btnNext = document.getElementById('hero-vid-next');
    const modal = document.getElementById('hero-mobile-modal');
    const scroller = document.getElementById('hero-modal-scroller');
    const closeBtn = document.getElementById('hero-modal-close');

    let currentIndex = 0;
    const isMobile = window.innerWidth < 768;
    const visibleCount = 3;
    const maxIndex = Math.max(0, videos.length - visibleCount);

    function init() {
      if (!track) return;

      // Create Carousel Cards
      track.innerHTML = '';
      videos.forEach((video, index) => {
        const card = document.createElement('div');
        // Card Styles matching Reference Image
        card.style.cssText =
          'position:relative; flex-shrink:0; aspect-ratio:9/16; border-radius:1.5rem; overflow:hidden; cursor:pointer; background:#171717; width:calc(33.333% - 1.05rem); border:none; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);';

        card.innerHTML = `
          <video src="${video.src}" loop muted playsinline preload="metadata" style="width:100%;height:100%;object-fit:cover;opacity:0.9;transition:transform 0.5s ease;pointer-events:none;" class="hero-video-el"></video>

          <!-- Gradient Overlay: Bottom Black/80 -> Transparent -->
          <div style="position:absolute; inset:0; background:linear-gradient(to top, rgba(0,0,0,0.9) 0%, rgba(0,0,0,0.4) 30%, transparent 100%); opacity:1; pointer-events:none;"></div>

          <!-- Play Icon Overlay (6.5rem) -->
          <div class="hero-play-icon" style="position:absolute; inset:0; display:flex; align-items:center; justify-content:center; pointer-events:none; transition:opacity 0.2s cubic-bezier(0.4, 0, 0.2, 1); opacity:1;">
             <div style="width:6.5rem; height:6.5rem; border-radius:50%; background:rgba(0,0,0,0.3); backdrop-filter:blur(4px); border:1px solid rgba(255,255,255,0.2); display:flex; align-items:center; justify-content:center;">
                <svg width="48" height="48" fill="white" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
             </div>
          </div>

          <!-- Title: Bold Italic Uppercase (Reference Style) -->
          <div style="position:absolute; bottom:1.5rem; left:1.2rem; right:1.2rem; color:white; font-family:'Inter', sans-serif; font-weight:900; font-style:italic; font-size:1.4rem; text-transform:uppercase; line-height:1; letter-spacing:-0.02em; pointer-events:none;">${video.title}.</div>

          <!-- Mute Button (3.25rem) -->
          <button style="position:absolute; top:1rem; right:1rem; width:3.25rem; height:3.25rem; border-radius:50%; background:rgba(0,0,0,0.4); backdrop-filter:blur(4px); border:none; color:white; display:flex; align-items:center; justify-content:center; z-index:10; cursor:pointer; transition:background 0.2s;" class="hero-card-mute">
             <svg style="width:20px; height:20px;" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2"/></svg>
          </button>
        `;

        // HOVER LOGIC
        card.addEventListener('mouseenter', () => {
          if (window.innerWidth >= 768) {
            const v = card.querySelector('video');
            const playIcon = card.querySelector('.hero-play-icon');
            v.play()
              .then(() => {
                playIcon.style.opacity = '0';
                v.style.transform = 'scale(1.05)';
                v.style.opacity = '1';
              })
              .catch(() => {});
          }
        });

        card.addEventListener('mouseleave', () => {
          if (window.innerWidth >= 768) {
            const v = card.querySelector('video');
            const playIcon = card.querySelector('.hero-play-icon');
            v.pause();
            v.currentTime = 0;
            playIcon.style.opacity = '1';
            v.style.transform = 'scale(1)';
            v.style.opacity = '0.9';
          }
        });
        card.addEventListener('click', () => {
          if (window.innerWidth < 768) openModal(index);
        });

        const muteBtn = card.querySelector('.hero-card-mute');
        muteBtn.addEventListener('click', (e) => {
          e.stopPropagation();
          const v = card.querySelector('video');
          v.muted = !v.muted;
          muteBtn.style.background = v.muted ? 'rgba(0,0,0,0.5)' : 'white';
          muteBtn.style.color = v.muted ? 'white' : 'black';
        });

        track.appendChild(card);
      });

      // Pagination
      pagination.innerHTML = '';
      for (let i = 0; i <= maxIndex; i += 1) {
        // if (i > 9) break; // Limit dots removed defined by Max Index
        const dot = document.createElement('button');
        dot.style.cssText =
          'width:0.4rem;height:0.4rem;border-radius:999px;background:rgba(255,255,255,0.2);border:none;cursor:pointer;transition:all 0.2s;';
        dot.onclick = () => {
          currentIndex = i;
          updateCarousel();
        };
        pagination.appendChild(dot);
      }

      // Mobile Modal Render
      scroller.innerHTML = '';
      videos.forEach((video, index) => {
        const item = document.createElement('div');
        item.style.cssText = 'width:100%;height:100dvh;scroll-snap-align:center;position:relative;background:black;';
        item.id = `hero-modal-video-${index}`;
        item.innerHTML = `
           <video src="${video.src}" loop playsinline preload="metadata" style="width:100%;height:100%;object-fit:cover;pointer-events:none;"></video>
           <div class="strongside-play-overlay" style="position:absolute;inset:0;display:none;align-items:center;justify-content:center;pointer-events:none;"><div style="width:4rem;height:4rem;background:rgba(0,0,0,0.4);border-radius:50%;display:flex;align-items:center;justify-content:center;color:white;"><svg width="24" height="24" fill="currentColor" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg></div></div>
           <button class="hero-modal-mute" style="position:absolute;top:7rem;right:1rem;z-index:50;width:3rem;height:3rem;border-radius:50%;background:rgba(0,0,0,0.4);color:white;border:1px solid rgba(255,255,255,0.1);display:flex;align-items:center;justify-content:center;cursor:pointer;"><svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z"/></svg></button>
           <div style="position:absolute;bottom:4rem;left:1rem;right:4rem;pointer-events:none;">
             <div style="color:white;font-size:1.5rem;font-weight:900;font-style:italic;text-transform:uppercase;text-shadow:0 2px 4px rgba(0,0,0,0.8);">${video.title}</div>
           </div>
         `;
        const vid = item.querySelector('video');
        const overlay = item.querySelector('.strongside-play-overlay');
        const mute = item.querySelector('.hero-modal-mute');

        item.addEventListener('click', () => {
          if (vid.paused) {
            vid.play();
            overlay.style.display = 'none';
          } else {
            vid.pause();
            overlay.style.display = 'flex';
          }
        });
        mute.addEventListener('click', (e) => {
          e.stopPropagation();
          vid.muted = !vid.muted;
          mute.style.background = vid.muted ? 'white' : 'rgba(0,0,0,0.4)';
          mute.style.color = vid.muted ? 'black' : 'white';
        });

        scroller.appendChild(item);
      });

      // Observer
      const observer = new IntersectionObserver(
        (entries) => {
          entries.forEach((entry) => {
            const vid = entry.target.querySelector('video');
            if (entry.isIntersecting) {
              vid.currentTime = 0;
              vid.play().catch(() => {});
            } else {
              vid.pause();
            }
          });
        },
        { threshold: 0.6 }
      );
      document.querySelectorAll('#hero-modal-scroller > div').forEach((el) => observer.observe(el));

      // --- FLUID TOUCH SWIPE SUPPORT (1:1 Tracking) ---
      let isDragging = false;
      let startPos = 0;
      let currentTranslate = 0;
      let animationID;
      let startTime = 0;

      // Disable transition during drag for responsiveness
      function setCarouselTransition(enable) {
        track.style.transition = enable ? 'transform 0.3s ease-out' : 'none';
      }

      function getPositionX(event) {
        return event.type.includes('mouse') ? event.pageX : event.touches[0].clientX;
      }

      function touchStart(event) {
        isDragging = true;
        startPos = getPositionX(event);
        startTime = new Date().getTime();
        setCarouselTransition(false);
        animationID = requestAnimationFrame(animation);
      }

      function touchMove(event) {
        if (isDragging) {
          const currentPosition = getPositionX(event);
          const currentDiff = currentPosition - startPos;

          // Calculate % diff based on container width
          const containerWidth = track.parentElement.offsetWidth;
          const diffPercent = (currentDiff / containerWidth) * 100;

          // Current base translate
          const baseTranslate = -currentIndex * 33.3333;
          currentTranslate = baseTranslate + diffPercent;

          // Elastic Bounds
          const minTranslate = -maxIndex * 33.3333;
          if (currentTranslate > 0) currentTranslate *= 0.3;
          else if (currentTranslate < minTranslate) {
            const over = minTranslate - currentTranslate;
            currentTranslate = minTranslate - over * 0.3;
          }
        }
      }

      function touchEnd() {
        isDragging = false;
        cancelAnimationFrame(animationID);
        setCarouselTransition(true);

        const movedBy = currentTranslate - -currentIndex * 33.3333;
        const endTime = new Date().getTime();
        const duration = endTime - startTime;

        // Thresholds
        const threshold = 15; // Increased for stability
        const velocity = Math.abs(movedBy) / duration;

        if (movedBy < -threshold || (movedBy < 0 && velocity > 0.5)) {
          if (currentIndex < maxIndex) currentIndex++;
        } else if (movedBy > threshold || (movedBy > 0 && velocity > 0.5)) {
          if (currentIndex > 0) currentIndex--;
        }

        updateCarousel();
      }

      function animation() {
        track.style.transform = `translateX(${currentTranslate}%)`;
        if (isDragging) requestAnimationFrame(animation);
      }

      track.addEventListener('touchstart', touchStart, { passive: true });
      track.addEventListener('touchmove', touchMove, { passive: true });
      track.addEventListener('touchend', touchEnd);
      // Mouse support for dev
      track.addEventListener('mousedown', touchStart);
      track.addEventListener('mousemove', touchMove);
      track.addEventListener('mouseup', touchEnd);
      track.addEventListener('mouseleave', () => {
        if (isDragging) touchEnd();
      });

      updateCarousel();
    }

    function updateCarousel() {
      track.style.transform = `translateX(-${currentIndex * 33.3333}%)`;

      Array.from(pagination.children).forEach((dot, idx) => {
        dot.style.background = idx === currentIndex ? '#ff2222' : 'rgba(255,255,255,0.2)';
        dot.style.width = idx === currentIndex ? '1.2rem' : '0.4rem';
      });

      if (btnPrev) btnPrev.style.opacity = currentIndex === 0 ? '0.3' : '1';
      if (btnNext) btnNext.style.opacity = currentIndex >= maxIndex ? '0.3' : '1';
    }

    function openModal(idx) {
      modal.style.display = 'block';
      document.body.style.overflow = 'hidden';
      scroller.scrollTo({ top: idx * window.innerHeight, behavior: 'auto' });
      const vid = document.getElementById(`hero-modal-video-${idx}`).querySelector('video');
      vid.muted = false;
    }

    function closeModal() {
      modal.style.display = 'none';
      document.body.style.overflow = '';
      document.querySelectorAll('#hero-modal-scroller video').forEach((v) => v.pause());
    }

    if (btnPrev)
      btnPrev.onclick = () => {
        if (currentIndex > 0) {
          currentIndex--;
          updateCarousel();
        }
      };
    if (btnNext)
      btnNext.onclick = () => {
        if (currentIndex < maxIndex) {
          currentIndex++;
          updateCarousel();
        }
      };
    if (closeBtn) closeBtn.onclick = closeModal;

    if (document.readyState !== 'loading') init();
    else document.addEventListener('DOMContentLoaded', init);
  })();
</script>

{% schema %}
{
  "name": "Strongside Hero Replica",
  "settings": [
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "t:sections.all.colors.label",
      "default": "scheme-1"
    },
    {
      "type": "product",
      "id": "product",
      "label": "Product to display"
    }
  ],
  "blocks": [
    {
      "type": "info_row",
      "name": "Accordion Row",
      "settings": [
        {
          "type": "text",
          "id": "title",
          "label": "Title",
          "default": "Livraison & Retours"
        },
        {
          "type": "richtext",
          "id": "content",
          "label": "Content",
          "default": "<p>Content here...</p>"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Strongside Hero Replica"
    }
  ]
}
{% endschema %}
